// Assign propellant types
@PART:HAS[@MODULE:HAS[#chemTechEngineType[hydrogen]]]:FOR[zz_ChemicalPropulsion]
{
	chemTechPropellantType = propellant
}
@PART:HAS[@MODULE:HAS[#chemTechEngineType[monopropellant]]]:FOR[zz_ChemicalPropulsion]
{
	chemTechPropellantType = propellant
}
@PART:HAS[@MODULE:HAS[#chemTechEngineType[bipropellant*]],~chemTechPropellantType[propellant]]:FOR[zz_ChemicalPropulsion]
{
	chemTechPropellantType = fuel
}
@PART:HAS[@MODULE:HAS[#chemTechEngineType[bipropellant*]]]:FOR[zz_ChemicalPropulsion]
{
	chemTechPropellantType = oxidizer
}
@PART:HAS[@MODULE:HAS[#chemTechEngineType[jet*]],~chemTechPropellantType[propellant]]:FOR[zz_ChemicalPropulsion]
{
	chemTechPropellantType = fuel
}
@PART:HAS[@MODULE:HAS[#chemTechEngineType[solid]]]:FOR[zz_ChemicalPropulsion]
{
	chemTechPropellantType = solid
}
@PART:HAS[#chemTechTankType[cryogenic]]:FOR[zz_ChemicalPropulsion]
{
	chemTechPropellantType = propellant
}
@PART:HAS[#chemTechTankType[monopropellant]]:FOR[zz_ChemicalPropulsion]
{
	chemTechPropellantType = propellant
}
@PART:HAS[#chemTechTankType[bipropellant],~chemTechPropellantType[propellant]]:FOR[zz_ChemicalPropulsion]
{
	chemTechPropellantType = fuel
}
@PART:HAS[#chemTechTankType[bipropellant]]:FOR[zz_ChemicalPropulsion]
{
	chemTechPropellantType = oxidizer
}
@PART:HAS[#chemTechTankType[aviation],~chemTechPropellantType[propellant]]:FOR[zz_ChemicalPropulsion]
{
	chemTechPropellantType = fuel
}
@PART:HAS[#chemTechTankType[aviation]]:FOR[zz_ChemicalPropulsion]
{
	chemTechPropellantType = oxidizer
}

// Create propellant modules
@PART:HAS[#chemTechPropellantType[propellant]]:FOR[zz_ChemicalPropulsion]
{
	MODULE
	{
		name = ModuleIgnitionPropellant
		moduleID = chemTechPropellant
		drawStackGauge = true
	}
}
@PART:HAS[#chemTechPropellantType[fuel]]:FOR[zz_ChemicalPropulsion]
{
	MODULE
	{
		name = ModuleIgnitionPropellant
		moduleID = chemTechFuel
		drawStackGauge = true
	}
}
@PART:HAS[#chemTechPropellantType[oxidizer]]:FOR[zz_ChemicalPropulsion]
{
	MODULE
	{
		name = ModuleIgnitionPropellant
		moduleID = chemTechOxidizer
	}
}
@PART:HAS[#chemTechPropellantType[solid]]:FOR[zz_ChemicalPropulsion]
{
	MODULE
	{
		name = ModuleIgnitionPropellant
		moduleID = chemTechSolid
		drawStackGauge = true
	}
}

// Ensure propellant ratio for jet engines is handled entirely by IntakeAir so that the single fuel ModuleIgnitionPropellant can work with multiple ModuleEngines with different ratios
@PART:HAS[@MODULE[ModuleEngines*]:HAS[#chemTechEngineType[jetKerosene],@PROPELLANT[Kerosene],@PROPELLANT[IntakeAir]]]:AFTER[zz_ChemicalPropulsion]
{
	@MODULE[ModuleEngines*]:HAS[#chemTechEngineType[jetKerosene],@PROPELLANT[Kerosene],@PROPELLANT[IntakeAir]]
	{
		@PROPELLANT[IntakeAir]
		{
			@ratio /= #$../PROPELLANT[Kerosene]/ratio$
		}
	}
	@MODULE[ModuleIgnitionPropellant]:HAS[#moduleID[chemTechFuel]]
	{
		ratio = 1
	}
}
@PART:HAS[@MODULE:HAS[#chemTechEngineType[jetHydrogen],@PROPELLANT[LqdHydrogen],@PROPELLANT[IntakeAir]]]:AFTER[zz_ChemicalPropulsion]
{
	@MODULE[ModuleEngines*]:HAS[#chemTechEngineType[jetHydrogen],@PROPELLANT[LqdHydrogen],@PROPELLANT[IntakeAir]]
	{
		@PROPELLANT[IntakeAir]
		{
			@ratio /= #$../PROPELLANT[LqdHydrogen]/ratio$
		}
	}
	@MODULE[ModuleIgnitionPropellant]:HAS[#moduleID[chemTechFuel]]
	{
		ratio = 1
	}
}

// Remove existing propellants
@PART:HAS[@MODULE:HAS[#chemTechEngineType]]:BEFORE[zzz_ChemicalPropulsion]
{
	@MODULE:HAS[#chemTechEngineType]
	{
		// Stock
		-PROPELLANT[LiquidFuel] {}
		-PROPELLANT[Oxidizer] {}
		-PROPELLANT[MonoPropellant] {}
		-PROPELLANT[SolidFuel] {}

		// Chemical Technologies
		-PROPELLANT[Kerosene] {}
		-PROPELLANT[LqdAmmonia] {}
		-PROPELLANT[LqdMethane] {}
		-PROPELLANT[LqdHydrogen] {}
		-PROPELLANT[Hydrazine] {}
		-PROPELLANT[Pentaborane] {}
		-PROPELLANT[Diborane] {}
		-PROPELLANT[HTP] {}
		-PROPELLANT[LqdOxygen] {}
		-PROPELLANT[NTO] {}
		-PROPELLANT[LqdFluorine] {}
		-PROPELLANT[N2F4] {}
	}
}